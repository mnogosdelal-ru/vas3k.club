{% extends "posts/show/layout.html" %}
{% load static %}
{% load posts %}
{% load text_filters %}

{% block post %}
<section class="content">
    <article class="post post-type-post">
        {% block post_header %}
            <header class="post-header">
                <div class="post-info">
                    {% if post.topic %}
                        {% include "posts/widgets/topic.html" with topic=post.topic type="post" %}
                    {% endif %}
                </div>
                <div class="post-title">
                    {% if post.prefix %}{{ post.prefix }} {% endif %}{{ post.title | rutypography }}
                </div>
                <span class="post-is-public">
                    {% if post.is_public %}
                        <i class="fas fa-globe-americas"></i>&nbsp;Публичный пост
                    {% else %}
                        <i class="fas fa-lock"></i>&nbsp;Только для своих
                    {% endif %}
                </span>
                <div class="post-data">
                    {% if post.deleted_at %}
                        <div class="post-label">
                            <span class="label label-type-deleted">
                                <span class="label-title">Удалённый пост</span>
                            </span>
                        </div>
                    {% elif not post.is_visible %}
                        <div class="post-label">
                            {% include "posts/widgets/draft_label.html" %}
                        </div>
                    {% endif %}

                    <div class="post-actions-line">
                        {% include "posts/widgets/post_actions_line.html" %}
                    </div>

                    <div class="post-author">
                        {% include "users/widgets/tiny.html" with user=post.author %}

                        {% if post.coauthors %}
                            {% for coauthor in post.coauthors_with_details %}
                                &nbsp;&nbsp;
                                {% include "users/widgets/tiny.html" with user=coauthor %}
                            {% endfor %}
                        {% endif %}

                    </div>

                    {% if post.label %}
                        <div class="post-label">
                            {% include "posts/widgets/label.html" with label=post.label %}
                        </div>
                    {% endif %}

                    {% if post.image %}
                        <div class="post-image">
                            <img src="{{ post.image }}" alt="{{ post.title }}">
                        </div>
                    {% endif %}
                </div>
            </header>
        {% endblock %}



                <table border="0" cellspacing="0" cellpadding="0" width="100%" style="text-align: center;">
                    <tbody>
                        <tr class="dgm_edgeboxrow">
                            <td></td>
                            <td colspan="4" class="dgm_condbox">
                                {{ post.metadata.crt.ab }}
                            </td>
                            <td></td>
                            <td colspan="4" class="dgm_condbox">
                                {{ post.metadata.crt.bd }}
                            </td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="dgm_emptyrow">
                            <td width="100"></td>
                            <td width="100"></td>
                            <td class="dgm_rightbordercondlink" width="30"></td>
                            <td width="40"></td>
                            <td width="80"></td>
                            <td width="80"></td>
                            <td width="50"></td>
                            <td class="dgm_rightbordercondlink" width="30"></td>
                            <td width="80"></td>
                            <td width="60"></td>
                            <td width="80"></td>
                            <td width="80"></td>
                        </tr>
                        <tr class="dgm_boxrow">
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordercondlink"></td>
                            <td class="dgm_lowbordermainlink"></td>
                            <td colspan="3" rowspan="2" class="dgm_mainbox">
                                {{ post.metadata.crt.b }}
                            </td>
                            <td class="dgm_lowbordermainlink dgm_rightbordercondlink"></td>
                            <td class="dgm_lowbordermainlink"></td>
                            <td colspan="3" rowspan="2" class="dgm_mainbox">
                                {{ post.metadata.crt.d }}
                            </td>
                        </tr>
                        <tr class="dgm_boxrow">
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordermainlink"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="dgm_emptyrow">
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordermainlink"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="dgm_rightborderconflictlink"></td>
                            <td></td>
                        </tr>
                        <tr class="dgm_midboxrow">
                            <td colspan="2" rowspan="4" class="dgm_mainbox">
                                {{ post.metadata.crt.a }}
                            </td>
                            <td class="dgm_lowbordermainlink dgm_rightbordermainlink"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td colspan="4" rowspan="4" class="dgm_condbox">
                                {{ post.metadata.crt.ddprime }}
                            </td>
                            <td class="dgm_rightborderconflictlink"></td>
                            <td>⚡</td>
                        </tr>
                        <tr class="dgm_midboxrow">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="dgm_rightborderconflictlink dgm_bottombordercondlink"></td>
                            <td>⚡</td>
                        </tr>
                        <tr class="dgm_midboxrow">
                            <td class="dgm_lowbordermainlink "></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="dgm_rightborderconflictlink"></td>
                            <td>⚡</td>
                        </tr>
                        <tr class="dgm_midboxrow">
                            <td class="dgm_rightbordermainlink"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="dgm_rightborderconflictlink"></td>
                            <td>⚡</td>
                        </tr>
                        <tr class="dgm_emptyrow">
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordermainlink"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="dgm_rightborderconflictlink"></td>
                            <td></td>
                        </tr>
                        <tr class="dgm_boxrow">
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordermainlink"></td>
                            <td class="dgm_lowbordermainlink"></td>
                            <td colspan="3" rowspan="2" class="dgm_mainbox">
                                {{ post.metadata.crt.c }}
                            </td>
                            <td class="dgm_lowbordermainlink"></td>
                            <td class="dgm_lowbordermainlink"></td>
                            <td colspan="3" rowspan="2" class="dgm_mainbox">
                                {{ post.metadata.crt.dprime }}
                            </td>
                        </tr>
                        <tr class="dgm_boxrow">
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordercondlink">
                            </td>
                            <td></td>
                            <td class="dgm_rightbordercondlink">
                            </td>
                            <td></td>
                        </tr>
                        <tr class="dgm_emptyrow">
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordercondlink">
                            </td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="dgm_rightbordercondlink">
                            </td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="dgm_edgeboxrow">
                            <td></td>
                            <td colspan="4" class="dgm_condbox">
                                {{ post.metadata.crt.ac }}
                            </td>
                            <td></td>
                            <td colspan="4" class="dgm_condbox">
                                {{ post.metadata.crt.cdprime }}
                            </td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>

                <br />

        {% block post_text %}
            <section class="post-text">
                {% block post_upvote %}
                    <post-upvote :initial-upvotes="{{ post.upvotes }}"
                                 :hours-to-retract-vote="{{settings.RETRACT_VOTE_IN_HOURS}}"
                                 upvote-url="{% url "upvote_post" post.slug %}"
                                 retract-vote-url="{% url "retract_post_vote" post.slug %}"
                                 {% if is_voted %}
                                    initial-is-voted
                                    initial-upvote-timestamp={{upvoted_at}}
                                 {% endif %}
                                 {% if not me|can_upvote:post or upvote_disabled %}is-disabled{% endif %}>
                    </post-upvote>
                {% endblock %}

                <div class="text-body text-body-type-post e-content">
                    {% render_post post %}
                </div>
            </section>
        {% endblock %}

        {% block post_footer %}
            <footer class="post-footer p-author">
                {% include "users/widgets/card.html" with user=post.author %}

                {% if post.coauthors %}
                    {% for coauthor in post.coauthors_with_details %}
                        {% include "users/widgets/card.html" with user=coauthor %}
                    {% endfor %}
                {% endif %}
            </footer>
        {% endblock %}
    </article>
</section>
{% endblock %}
